<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Google Sheet Reader</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="bg-white shadow-lg rounded-lg p-8 max-w-xl w-full">
    <h1 class="text-2xl font-bold mb-4 text-center">🔗 Lire une Google Sheet</h1>

    <!-- Input + Aide -->
    <div class="mb-6">
      <label for="sheetInput" class="block font-semibold mb-2 text-center">Collez l'ID ou l'URL de votre Google Sheet :</label>
      <input
        type="text"
        id="sheetInput"
        placeholder="Ex : 1HdxIB4vFde1gcd01Cb74doAg2y3B58_wkC48uJ423dU"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"
        value=""
      />
      <p class="text-gray-600 text-sm mt-2 text-center">
        📌 L’ID est dans l’URL de votre feuille :<br />
        <code>https://docs.google.com/spreadsheets/d/<strong>VOTRE_ID_ICI</strong>/edit</code>
      </p>
    </div>

    <!-- Bouton -->
    <div class="flex justify-center">
      <button
        id="submitBtn"
        class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition duration-200"
      >
        Envoyer
      </button>
    </div>

    <!-- Résultat -->
    <div id="response" class="mt-6 bg-gray-50 p-4 rounded border border-gray-200 text-sm text-gray-800"></div>
  </div>

  <script>
    const baseUrl = "https://script.google.com/macros/s/AKfycbxvjNtUn9RxsS9QAKoECszvlwn6Cw9aTAVhW8zfm9OHC4K-bRaEZR7e4hBww0v5JdnX/exec";

    document.getElementById("submitBtn").addEventListener("click", async () => {
      const input = document.getElementById("sheetInput").value.trim();
      const responseEl = document.getElementById("response");

      if (!input) {
        responseEl.textContent = "❗️Veuillez entrer un ID ou une URL de Google Sheet.";
        return;
      }

      const sheetIdMatch = input.match(/[-\w]{25,}/);
      const sheetId = sheetIdMatch ? sheetIdMatch[0] : null;

      if (!sheetId) {
        responseEl.textContent = "❗️ID de Google Sheet invalide.";
        return;
      }

      responseEl.textContent = "⏳ Lecture en cours...";

      try {
        const res = await fetch(`${baseUrl}?sheetId=${sheetId}`);
        const data = await res.json();

        if (data.error) {
          responseEl.textContent = `❌ Erreur : ${data.error}`;
        } else {
          responseEl.textContent = `✅ Feuille lue avec succès :\n${JSON.stringify(data, null, 2)}`;
        }
      } catch (error) {
        responseEl.textContent = `❌ Une erreur s'est produite : ${error.message}`;
      }
    });
  </script>
</body>
</html>
