<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Social Flow - Formulaire de publication</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input, textarea, select { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
    button { margin-top: 15px; padding: 10px 20px; font-size: 16px; }
    .status { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>

  <h1>Social Flow - Publier un post</h1>

  <form id="postForm">
    <label for="sheetId">ID Google Sheet :</label>
    <input type="text" id="sheetId" name="sheetId" required placeholder="Entrez l'ID de votre Google Sheet" />

    <label for="platform">Plateforme :</label>
    <select id="platform" name="platform" required>
      <option value="">-- Choisir une plateforme --</option>
      <option value="Facebook">Facebook</option>
      <option value="Instagram">Instagram</option>
      <option value="Twitter">Twitter</option>
      <option value="LinkedIn">LinkedIn</option>
    </select>

    <label for="message">Message :</label>
    <textarea id="message" name="message" rows="4" required placeholder="Votre message"></textarea>

    <label for="texte">Texte (optionnel) :</label>
    <textarea id="texte" name="texte" rows="2" placeholder="Texte additionnel"></textarea>

    <label for="imageUrl">Image URL (optionnel) :</label>
    <input type="url" id="imageUrl" name="imageUrl" placeholder="https://..." />

    <label for="videoUrl">Vidéo URL (optionnel) :</label>
    <input type="url" id="videoUrl" name="videoUrl" placeholder="https://..." />

    <label for="statut">Statut :</label>
    <select id="statut" name="statut">
      <option value="Prévu" selected>Prévu</option>
      <option value="Publié">Publié</option>
      <option value="Annulé">Annulé</option>
    </select>

    <button type="submit">Envoyer</button>
  </form>

  <div class="status" id="status"></div>

  <script>
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzlyKjS89jIO_QPnEaE7ybscAttaSZJ_RjcwC1r2HfbwrN_NCfuN_MxrnDfzTiVZ3Wq/exec';

    document.getElementById('postForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const form = e.target;
      const statusDiv = document.getElementById('status');

      const data = {
        sheetId: form.sheetId.value.trim(),
        platform: form.platform.value,
        message: form.message.value.trim(),
        texte: form.texte.value.trim(),
        imageUrl: form.imageUrl.value.trim(),
        videoUrl: form.videoUrl.value.trim(),
        statut: form.statut.value
      };

      if (!data.sheetId || !data.platform || !data.message) {
        statusDiv.textContent = "Veuillez remplir au minimum l'ID de la feuille, la plateforme et le message.";
        statusDiv.style.color = "red";
        return;
      }

      statusDiv.textContent = "Envoi en cours...";
      statusDiv.style.color = "black";

      fetch(APPS_SCRIPT_URL + '?sheetId=' + encodeURIComponent(data.sheetId), {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(data)
      })
      .then(response => response.json())
      .then(json => {
        if (json.success) {
          statusDiv.textContent = `Post ajouté avec l'ID ${json.id} ✅`;
          statusDiv.style.color = "green";
          form.reset();
        } else if (json.error) {
          statusDiv.textContent = "Erreur : " + json.error;
          statusDiv.style.color = "red";
        } else {
          statusDiv.textContent = "Erreur inconnue.";
          statusDiv.style.color = "red";
        }
      })
      .catch(err => {
        statusDiv.textContent = "Erreur réseau ou serveur.";
        statusDiv.style.color = "red";
        console.error(err);
      });
    });
  </script>

</body>
</html>
